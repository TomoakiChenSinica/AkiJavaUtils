# Lib 設計邊界討論紀錄

> 討論日期：2026-01-22

## 背景

在設計 AkiDataFileSystem lib 時，感覺從「原本寫檔案系統的角度」跟「設計 lib 的角度」有衝突，需要釐清。

## 原本系統的資料結構

```
主資料 A（如 User, Order）
    │
    └── 一對多 ──► 關聯資料 B（DataFileRelation）
                        │
                        └── 一對一 ──► 實際檔案
                              │
                              ├── fileRealName: UUID（檔案系統用）
                              └── fileDisplayName: 原始檔名（給使用者看）
```

- **A 和 B**：一對多
- **B 和實際檔案**：一對一
- **A 和實際檔案**：一對多

## 原本系統的檔名處理

| 欄位 | 用途 | 值的來源 |
|------|------|----------|
| `fileRealName` | 檔案系統上的檔名 | UUID/ID（避免中文等問題） |
| `fileDisplayName` | 顯示給使用者 | 原始上傳檔名 |

副檔名：原本沒特別處理，打算開放讓使用者決定。

## 衝突點分析

| 面向 | 原本系統 | Lib 設計的困惑 |
|------|----------|----------------|
| **檔名來源** | UUID，自己產生後存入 B | NamingStrategy 想幫忙產生，但沒有寫回機制 |
| **副檔名** | 沒特別處理 | 要開放，但該放哪？realName 包含？還是分開？ |
| **Lib 職責** | 清楚整個流程 | 不確定 lib 該管到哪裡 |

## 建議的職責劃分

### 使用者負責

- 產生 `fileRealName`（可用 lib 提供的 UUID 工具）
- 產生 `fileDisplayName`
- 設定到 `DataFileRelation`
- 決定何時存 DB

### Lib 負責

- 組合路徑（rootPath + fileRealName）
- 存檔案到檔案系統
- 讀檔案
- 刪檔案

### Lib 提供的工具（可選）

- `UUIDNamingStrategy` 或 `FileNameUtils`
- 使用者想用就用，不強制

## 關於副檔名

**建議：fileRealName 包含副檔名**

- 例如：`550e8400-e29b-41d4-a716-446655440000.pdf`
- 這樣檔案系統上也能識別類型
- 使用者自己決定要不要加

## 視覺化職責邊界

```
┌─────────────────────────────────────────────────┐
│  使用者負責                                       │
│  ├── 產生 fileRealName（可用 lib 提供的 UUID 工具）│
│  ├── 產生 fileDisplayName                        │
│  ├── 設定到 DataFileRelation                     │
│  └── 決定何時存 DB                               │
└─────────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────┐
│  Lib 負責                                        │
│  ├── 組合路徑（rootPath + fileRealName）          │
│  ├── 存檔案到檔案系統                             │
│  ├── 讀檔案                                      │
│  └── 刪檔案                                      │
└─────────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────┐
│  Lib 提供的工具（可選）                           │
│  └── UUIDNamingStrategy / FileNameUtils         │
└─────────────────────────────────────────────────┘
```

## 待思考

- [ ] 這個職責劃分是否符合實際使用情境？
- [ ] 副檔名是否要獨立欄位，還是包含在 fileRealName？
- [ ] NamingStrategy 是否保留為 utility，或完全移除？

## 相關討論

- [DISCUSSION_NamingStrategy.md](./DISCUSSION_NamingStrategy.md)
